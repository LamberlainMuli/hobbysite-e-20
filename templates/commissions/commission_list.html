{% extends 'base.html' %}
{% load static %}
{% block header %}Commissions List{% endblock %}
{% block title %}Commissions List{% endblock %}
{% block content %}
  {% if request.user.is_authenticated %}
    <h3>Your Commissions:</h3>
    <ul>
    {% for commission in user_commissions %}
     <li> <a href="{{commission.get_absolute_url}}"> {{commission}} </a> </li>
    {% empty %}
      <li>No commissions created yet.</li>
    {% endfor %}
    </ul>

    <h3>Commissions You've Applied To:</h3>
    <ul>
      {% for commission in applied_commissions %}
        <li>
          <a href="{{ commission.get_absolute_url }}">{{ commission }}</a>
          <ul>
            {% for job in commission.jobs.all %}
              {% for application in job.applications.all%}
                {% if application.applicant == request.user %}
                  <li>Applied for: {{ application.job.role }} on {{ application.applied_on|date:"F d, Y H:i" }}. Current Status: {{ application.status }}</li>
                {% endif %}
                  {% empty %}
                  <li>No applications yet for this job.</li>
                {% endfor %}
              {% empty %}
                <li>No jobs listed in this commission.</li>
              
            {% endfor %}
          </ul>
        </li>
      {% empty %}
        <li>No commission applications yet.</li>
      {% endfor %}
    </ul>
    

    <a href="{% url 'commissions:commission-create' %}">
      <button>Create Commission</button>
    </a>
  {% endif %}

  <h3>All Commissions:</h3>
  <ul> 
  {% for commission in object_list %}
    <li> <a href="{{commission.get_absolute_url}}"> {{commission}} </a> </li>
  {% empty %}
    <li>No commissions available.</li>
  {% endfor %}
  </ul>
{% endblock %}